<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Page Title</title>
	<script type="text/javascript" src="../../dojo/dojo.js"></script>
	<script>
		dojo.ready(function(){
			function echo(msg) {
				dojo.create("li",{
					innerHTML: Array.prototype.join.call(arguments, " ")
				}, "logList");
			}
			console.log("ready: ", require);
			 require(["./Sequence.js"], function(Sequence){
				dojo.connect(console, "log", echo);
				console.log("ready");
				
				var thing = {
					onBegin: function(){
						var defd = new dojo.Deferred();
						setTimeout(function(){
							console.log("onBegin callback after 1000");
							defd.callback("begun");
						}, 1000)
						return defd;
					},
					onMiddle: function(){
						console.log("onMiddle function (sync)");
					},
					onEnd: function(){
						var defd = new dojo.Deferred();
						setTimeout(function(){
							console.log("onEnd callback after 20");
							defd.callback("done");
						}, 20)
						return defd;
					},
					start: function(){
						var sequence = Sequence(
							dojo.hitch(this, "onBegin"),
							dojo.hitch(this, "onMiddle"),
							dojo.hitch(this, "onEnd")
						);
						dojo.when(sequence.next(), function(result){
							console.log("Done:", result);
						})
					}
				}
				thing.start();
			})
		})
	</script>
</head>
<body>
<h1>Sequence test</h1>	
<ol id="logList"></ol>
</body>
</html>
